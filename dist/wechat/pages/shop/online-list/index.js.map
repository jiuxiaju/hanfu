{"version":3,"file":"pages/shop/online-list/index.js","mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./pages/shop/online-list/index.ts"],"sourcesContent":["var __MOR_API__ = require('@morjs/api').mor;\n\nimport { __assign } from \"tslib\";\n/*\n * @Author: 兼爱\n * @Date: 2023-10-24 01:56:21\n * @LastEditTime: 2023-12-08 03:32:18\n * @LastEditors: 兼爱\n * @Description:\n * @FilePath: /hanfu/src/components/shop/online/online.ts\n * 可以输入预定的版权声明、个性签名、空行等\n */\nimport { aComponent } from '@ali/mor-core';\nvar options = [\n    {\n        value: '1',\n        label: '淘宝',\n        icon: 'https://gw.alicdn.com/imgextra/i3/O1CN01uRn4VL1Oy57aWZzRo_!!6000000001773-2-tps-24-24.png',\n    }, {\n        value: '2',\n        label: '拼多多',\n        icon: 'https://gw.alicdn.com/imgextra/i4/O1CN01awoIdD1fq9jnbj1aV_!!6000000004057-0-tps-24-24.jpg',\n    }, {\n        value: '3',\n        label: '抖音',\n        icon: 'https://gw.alicdn.com/imgextra/i3/O1CN01mT75pL1yJ9tvR5weD_!!6000000006557-2-tps-24-24.png',\n    }, {\n        value: '4',\n        label: '京东',\n        icon: 'https://gw.alicdn.com/imgextra/i1/O1CN01to53GL1W8LJ2iMnkW_!!6000000002743-2-tps-24-24.png',\n    }, {\n        value: '5',\n        label: '微店',\n        icon: 'https://gw.alicdn.com/imgextra/i2/O1CN01ZmFC5H1rKLcQlutEv_!!6000000005612-2-tps-24-24.png',\n    }, {\n        value: '6',\n        label: '小红书',\n        icon: 'https://gw.alicdn.com/imgextra/i4/O1CN01NzvJMm1L70NKjP0FP_!!6000000001251-2-tps-24-24.png',\n    }\n];\naComponent({\n    props: {\n        className: '',\n        data: {},\n        onClick: function () { },\n    },\n    data: {\n        rowColsAvatar: [{ size: '100px', type: 'circle' }],\n        rowColsImage: [{ size: '100px', type: 'rect' }],\n        rowColsContent: [{ width: '80%' }, { width: '100%' }, { width: '80%' }],\n        source: [],\n        options: options,\n        dynamicFilters: {},\n        showLoading: true,\n        styleOptions: [\n            {\n                value: '衣裳',\n                label: '衣裳'\n            }\n        ],\n        menuFilters: {},\n        menuData: [],\n        filteredData: {},\n        list: [],\n        displayList: [],\n        batchSize: 10,\n        currentDisplayCount: 0,\n        showNoData: false,\n        style: [],\n        sourceLabel: '店铺来源',\n        styleLabel: '形制',\n        config: {\n            \"online_shop_set\": {\n                \"fields\": [\"style\", \"store\"],\n                \"displayValuesOnly\": [\"style\"],\n                \"fieldLabels\": {},\n                \"styles\": {\n                    \"style\": {\n                        \"background-color\": \"#a866001a\",\n                        \"color\": \"#A86600\"\n                    }\n                }\n            },\n        },\n        mergedData: {},\n    },\n    didMount: function () {\n        this.onSearch();\n        this.fetchMenuData();\n    },\n    methods: {\n        onClick: function () {\n        },\n        handleSourceChange: function (event) {\n            var value = event.detail.value;\n            this.setData({\n                source: event.detail.value,\n                sourceLabel: (value === null || value === void 0 ? void 0 : value.length) ? \"\\u5E97\\u94FA\\u6765\\u6E90(\" + value.length + \")\" : '店铺来源'\n            });\n            this.onSearch();\n        },\n        handleStyleChange: function (event) {\n            var value = event.detail.value;\n            this.setData({\n                style: value,\n                styleLabel: (value === null || value === void 0 ? void 0 : value.length) ? \"\\u5F62\\u5236(\" + value.length + \")\" : '形制'\n            });\n            this.onSearch();\n        },\n        onScrollViewScroll: function (e) {\n            var scrollTop = e.detail.scrollTop; // 用户当前已滚动的距离\n            var scrollHeight = e.detail.scrollHeight; // scroll-view 内容的总高度\n            var scrollViewHeight = 700; // scroll-view 的固定高度\n            var triggerHeight = 200; // 触发加载数据的提前量（距底部 200px）\n            // 检查是否接近底部，并触发数据加载\n            if (scrollTop + scrollViewHeight >= scrollHeight - triggerHeight) {\n                console.log('接近底部，加载更多数据...');\n                this.onScrollToLower();\n            }\n        },\n        onScrollToLower: function () {\n            // 当滑动到页面底部时触发\n            var _a = this.data, list = _a.list, displayList = _a.displayList, currentDisplayCount = _a.currentDisplayCount, batchSize = _a.batchSize;\n            console.log(currentDisplayCount, 'currentDisplayCount');\n            var nextDisplayCount = currentDisplayCount + batchSize;\n            if (currentDisplayCount < list.length) {\n                // 有更多数据可以加载\n                var moreData = list.slice(currentDisplayCount, nextDisplayCount);\n                this.setData({\n                    displayList: displayList.concat(moreData),\n                    currentDisplayCount: nextDisplayCount, // 更新已显示的数据数量\n                });\n                console.log(displayList, 'displayList');\n            }\n        },\n        handleItemClick: function (event) {\n            var item = event.detail;\n            console.log(item, 'item');\n            // 检查 shouldNavigate 字段\n            if (!item.hasOwnProperty('shouldNavigate') || !item.shouldNavigate) {\n                __MOR_API__.showToast({ title: '该店铺不可跳转', icon: 'none' });\n                return;\n            }\n            var itemId = item._id;\n            __MOR_API__.navigateTo({\n                url: \"/pages/shop/online-detail/index?itemId=\" + itemId,\n            });\n        },\n        fetchMenuData: function () {\n            var _this = this;\n            wx.cloud.callFunction({\n                name: 'menuOptions', // 请替换成您的云函数名\n            }).then(function (res) {\n                var result = res.result; // 这里接收到的result应该是一个数组\n                _this.setData({\n                    menuData: result\n                });\n            });\n        },\n        //菜单筛选\n        handleMenuData: function (event) {\n            var menuData = event.detail;\n            this.setData({\n                menuFilters: menuData\n            });\n            var filteredData = __assign(__assign({}, menuData), this.data.dynamicFilters);\n            this.onSearch(filteredData);\n        },\n        handleDynamicChange: function (event) {\n            var dynamicData = event.detail;\n            this.setData({\n                dynamicFilters: dynamicData\n            });\n            var filteredData = __assign(__assign({}, this.data.menuFilters), dynamicData);\n            this.onSearch(filteredData, true);\n            console.log(filteredData, 'filteredData-dynamicFilters');\n        },\n        onSearch: function (filteredData, isDynamicFilter) {\n            var _this = this;\n            if (filteredData === void 0) { filteredData = {}; }\n            if (isDynamicFilter === void 0) { isDynamicFilter = false; }\n            console.log(filteredData, 'filteredData-filteredData');\n            // 调用云函数\n            wx.cloud.callFunction({\n                // 云函数名称\n                name: 'onsearchOnineShop',\n                // 传给云函数的参数\n                data: {\n                    filteredData: filteredData,\n                },\n            }).\n                then(function (res) {\n                var result = res.result;\n                console.log(result, 'result-result');\n                if (result) {\n                    var dataList = result.data;\n                    if (dataList && dataList.length > 0) {\n                        // const newState = {\n                        //   config: result.config,\n                        //   list: dataList,\n                        //   displayList: dataList.slice(0, this.data.batchSize),\n                        //   showLoading: false, // 数据加载完毕，隐藏加载动画\n                        //   showNoData: false,\n                        //   currentDisplayCount: 10\n                        // };\n                        // if (!isDynamicFilter) {\n                        //   newState.mergedData = result.mergedData || {}; // 默认值为空对象\n                        // }\n                        // this.setData(newState, () => {\n                        //   wx.nextTick(() => {\n                        //     console.log('Force update');\n                        //     // 强制更新视图\n                        //   });\n                        // });\n                        // console.log(newState,'newState')\n                        _this.setData({\n                            list: dataList,\n                            displayList: dataList.slice(0, _this.data.batchSize),\n                            showLoading: false,\n                            showNoData: false,\n                            config: result.config,\n                            currentDisplayCount: 10\n                        });\n                        if (!isDynamicFilter) {\n                            _this.setData({\n                                mergedData: result.mergedData || {}\n                            });\n                        }\n                    }\n                    else {\n                        _this.setData({\n                            showNoData: true,\n                            showLoading: false, // 数据加载完毕但是无数据，隐藏加载动画\n                        });\n                    }\n                }\n                else {\n                    // 请求失败或云函数执行不成功\n                    _this.setData({\n                        showNoData: true,\n                        showLoading: false, // 数据加载失败，显示无数据提示\n                    });\n                }\n            }).catch(function (err) {\n                console.error(err);\n                // 处理任何在请求中发生的错误\n                console.error('云函数调用失败：', err);\n                _this.setData({\n                    showNoData: true,\n                    showLoading: false, // 请求失败，显示无数据提示\n                });\n            });\n        }\n    }\n});\n"],"names":[],"sourceRoot":""}