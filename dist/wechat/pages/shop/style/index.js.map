{"version":3,"file":"pages/shop/style/index.js","mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./pages/shop/style/index.ts"],"sourcesContent":["var __MOR_PAGE__ = require('@ali/mor-core').createPage;\n\nvar __MOR_API__ = require('@morjs/api').mor;\n\n\"use strict\";\n__MOR_PAGE__({\n    data: {\n        product: {},\n        skuList: [],\n        config: {\n            fieldsToShow: ['brand', 'size', 'delivery'],\n            labels: {\n                brand: '品牌',\n                size: '尺码',\n                delivery: '发货周期'\n            }\n        },\n        loading: true,\n        images: [],\n        currentImageIndex: 0,\n        currentSkuIndex: 0,\n        imageHeights: [],\n        containerHeight: 300,\n        tabVisible: false,\n    },\n    onLoad: function (query) {\n        var _this = this;\n        var itemId = query.itemId || '';\n        this.setData({\n            itemId: itemId\n        });\n        wx.cloud\n            .callFunction({\n            // 云函数名称\n            name: \"item-sku\",\n            data: {\n                itemId: itemId\n            }\n        })\n            .then(function (res) {\n            console.log(res, 'res');\n            var result = res.result;\n            _this.setData({\n                styleetails: result.data[0],\n                skuList: result.data[0].skuList,\n                config: result.config,\n                images: result.data[0].images,\n                product: result.data[0],\n                loading: false\n            });\n        });\n        // 初始化 imageHeights 数组\n        var totalImages = this.data.images.length + this.data.skuList.length;\n        var initialHeights = new Array(totalImages).fill(0);\n        this.setData({\n            imageHeights: initialHeights\n        });\n    },\n    // 点击main-icon时，切换预览区图片。\n    onMainIconClick: function () {\n        this.setData({\n            currentSkuIndex: -1,\n            currentImageIndex: 0 // 显示第一张图片\n        });\n        this.scrollToImage();\n    },\n    // 点击SKU icon时，切换预览区\n    onIconClick: function (event) {\n        var index = event.currentTarget.dataset.index;\n        this.setData({\n            currentSkuIndex: index,\n            currentImageIndex: this.data.images.length + index\n        });\n        this.scrollToImage();\n    },\n    // 处理轮播图滑动（或点击）事件，更新当前索引\n    onSwiperChange: function (e) {\n        var currentImageIndex = e.detail.current;\n        this.setData({\n            currentImageIndex: currentImageIndex,\n            // currentSkuIndex: currentImageIndex < this.data.images.length ? -1 : currentImageIndex - this.data.images.length\n            currentSkuIndex: currentImageIndex >= this.data.images.length\n                ? currentImageIndex - this.data.images.length\n                : -1\n        });\n        // 调整容器高度\n        this.adjustContainerHeight();\n    },\n    // 获取图片的高度\n    onImageLoad: function (e) {\n        var _a = e.detail, width = _a.width, height = _a.height;\n        var windowWidth = wx.getSystemInfoSync().windowWidth;\n        // 计算图片显示高度\n        var aspectRatio = width / height;\n        var containerHeight = windowWidth / aspectRatio;\n        var index = e.currentTarget.dataset.index; // 从dataset获取索引\n        var imageHeights = this.data.imageHeights;\n        // 更新 imageHeights 数组中的特定索引值\n        if (index !== undefined) {\n            imageHeights[index] = containerHeight;\n            this.setData({ imageHeights: imageHeights });\n            // 如果当前加载图片是正在显示的图片时，调整容器高度\n            if (index === this.data.currentImageIndex) {\n                this.setData({ containerHeight: containerHeight });\n            }\n            // 如果是首次加载，设置第一页的高度\n            if (index === 0) {\n                this.setData({ containerHeight: containerHeight });\n            }\n        }\n        else {\n            console.warn('onImageLoad - index is undefined');\n        }\n    },\n    // 滚动到选中的图片\n    scrollToImage: function () {\n        var windowWidth = wx.getSystemInfoSync().windowWidth;\n        var scrollLeft = this.data.currentImageIndex * windowWidth;\n        this.setData({\n            scrollLeft: scrollLeft\n        });\n        // 调整容器高度\n        this.adjustContainerHeight();\n    },\n    // 根据图片高度调整容器高度\n    adjustContainerHeight: function () {\n        var _a = this.data, imageHeights = _a.imageHeights, currentImageIndex = _a.currentImageIndex;\n        var containerHeight = imageHeights[currentImageIndex];\n        if (containerHeight) {\n            this.setData({\n                containerHeight: containerHeight\n            });\n        }\n    },\n    //分享给好友\n    onShareAppMessage: function () {\n        var app = getApp(); // 获取全局应用实例\n        var promise = new Promise(function (resolve) {\n            app.generateShareInfo().then(function (shareInfo) {\n                // 在这里处理生成的分享信息\n                resolve(shareInfo);\n            });\n        });\n        return {\n            title: '九霞裾',\n            path: '/pages/home',\n            promise: promise\n        };\n    },\n    previewImage: function (event) {\n        var urls = this.data.images.concat(this.data.skuList.map(function (item) { return item.image; }));\n        // 获取当前点击的图片地址\n        var current = urls[event.currentTarget.dataset.index];\n        __MOR_API__.previewImage({\n            current: current,\n            urls: urls // 需要预览的图片http链接列表\n        });\n    },\n    //转发到朋友圈\n    onShareTimeline: function () {\n        return {\n            title: '快来看看'\n        };\n    },\n    handleShopClick: function (event) {\n        var itemId = event.currentTarget.dataset.shopId;\n        __MOR_API__.navigateTo({\n            url: \"/pages/shop/online-detail/index?itemId=\" + itemId,\n        });\n    },\n    previewDetailImage: function (event) {\n        var current = event.currentTarget.dataset.index;\n        var imageUrls = this.data.skuList.map(function (sku) { return sku.image; });\n        wx.previewImage({\n            current: imageUrls[current],\n            urls: imageUrls // 需要预览的图片http链接列表\n        });\n    },\n    //检测页面滚动高度\n    onPageScroll: function (event) {\n        var _this = this;\n        var query = wx.createSelectorQuery();\n        query.select('#detailsSection').boundingClientRect(function (rect) {\n            var tabVisible = rect.top <= 0;\n            if (tabVisible !== _this.data.tabVisible) {\n                _this.setData({ tabVisible: tabVisible });\n            }\n        }).exec();\n    },\n    scrollToTop: function () {\n        wx.pageScrollTo({\n            scrollTop: 0,\n            duration: 600\n        });\n    },\n    scrollToDetails: function () {\n        var query = wx.createSelectorQuery();\n        query.select('#detailsSection').boundingClientRect(function (rect) {\n            if (rect) {\n                wx.pageScrollTo({\n                    scrollTop: rect.top + wx.getSystemInfoSync().scrollTop,\n                    duration: 600\n                });\n            }\n            else {\n                console.error('无法获取 detailsSection 的位置信息');\n            }\n        }).exec();\n    }\n}, \"a\");\n"],"names":[],"sourceRoot":""}