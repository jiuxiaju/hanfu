{"version":3,"file":"pages/shop/offline-detail/index.js","mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./pages/shop/offline-detail/index.ts"],"sourcesContent":["var __MOR_API__ = require('@morjs/api').mor;\n\nimport { aPage } from '@ali/mor-core';\naPage({\n    data: {\n        currentImageIndex: 0,\n        containerHeight: 200,\n        shopInfo: {\n            styles: [],\n            images: [],\n            tags: [],\n        },\n        showLoading: true,\n        styles: [],\n        itemId: '',\n        images: [],\n        tags: [],\n        rowCol: [{ width: '100%', height: '100px' }],\n    },\n    onLoad: function (query) {\n        var _this = this;\n        var itemId = query.itemId || '';\n        this.setData({\n            itemId: itemId\n        });\n        console.log(itemId, 'itemId');\n        wx.cloud\n            .callFunction({\n            // 云函数名称\n            name: \"offline-detail\",\n            data: {\n                itemId: itemId\n            }\n        })\n            .then(function (res) {\n            console.log(res, 'data');\n            var data = res.result[0];\n            if (data) {\n                _this.setData({\n                    shopInfo: data,\n                    images: data.images,\n                    style: data.style,\n                    isOpen: _this.isShopOpen(data.businessHours),\n                    showLoading: false // 数据加载完毕，隐藏加载动画\n                });\n            }\n            else {\n                // 如果data为空，你可以根据需求处理，如隐藏动画等\n                _this.setData({\n                    showLoading: false, // 数据加载完毕，隐藏加载动画\n                });\n            }\n            console.log(data, 'data');\n        }).catch(function (err) {\n            console.error(err);\n            _this.setData({\n                showLoading: false, // 如果请求失败，隐藏加载动画\n            });\n        });\n        this.adjustContainerHeight();\n    },\n    onShareAppMessage: function () {\n        var promise = new Promise(function (resolve) {\n            setTimeout(function () {\n                resolve({\n                    title: '九霞裾',\n                });\n            }, 20);\n        });\n        return {\n            title: '九霞裾',\n            path: '/pages/home',\n            promise: promise,\n        };\n    },\n    //转发到朋友圈\n    onShareTimeline: function () {\n        return {\n            title: '快来看看',\n        };\n    },\n    handlePopup: function (e) {\n        var _this = this;\n        var item = e.currentTarget.dataset.item;\n        this.setData({\n            cur: item,\n        }, function () {\n            _this.setData({ visible: true });\n        });\n    },\n    onVisibleChange: function (e) {\n        this.setData({\n            visible: e.detail.visible,\n        });\n    },\n    previewImage: function (event) {\n        var index = event.currentTarget.dataset.index;\n        wx.previewImage({\n            current: this.data.images[index],\n            urls: this.data.images // 需要预览的图片http链接列表\n        });\n    },\n    onSwiperChange: function (e) {\n        var currentImageIndex = e.detail.current;\n        this.setData({\n            currentImageIndex: currentImageIndex\n        });\n        // 调整容器高度\n        this.adjustContainerHeight();\n    },\n    onImageLoad: function (e) {\n        // 计算每张图片的实际高度\n        var _a = e.detail, width = _a.width, height = _a.height;\n        // 以当前图片的宽高比计算其在Swiper中的高度\n        var containerWidth = wx.getSystemInfoSync().windowWidth;\n        var calculatedHeight = (height / width) * containerWidth;\n        // 设置容器高度\n        this.setData({\n            containerHeight: calculatedHeight\n        });\n    },\n    adjustContainerHeight: function () {\n        var _this = this;\n        var currentImageSrc = this.data.shopInfo.images[this.data.currentImageIndex];\n        // 获取当前图片的宽高信息，重新调整容器高度\n        wx.getImageInfo({\n            src: currentImageSrc,\n            success: function (res) {\n                var width = res.width, height = res.height;\n                // 以当前图片的宽高比计算其在Swiper中的高度\n                var containerWidth = wx.getSystemInfoSync().windowWidth;\n                var calculatedHeight = (height / width) * containerWidth;\n                _this.setData({\n                    containerHeight: calculatedHeight\n                });\n            }\n        });\n    },\n    isShopOpen: function (businessHours) {\n        var now = new Date();\n        var currentDay = (now.getDay() + 6) % 7 + 1; // 星期几 (周一到周日分别为 1 到 7)\n        var currentTime = now.toTimeString().split(' ')[0]; // 当前时间 (HH:MM:SS)\n        var daysMap = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];\n        var today = daysMap[currentDay - 1];\n        var todayHours = businessHours.find(function (day) { return day.day === today; });\n        if (!todayHours || todayHours.hours === '休息') {\n            return false;\n        }\n        var _a = todayHours.hours.split(' - '), openTime = _a[0], closeTime = _a[1];\n        return currentTime >= openTime && currentTime <= closeTime;\n    },\n    navigateToUrl: function (event) {\n        var style = event.currentTarget.dataset.style;\n        console.log('navigateToUrl:', style); // 调试输出\n        __MOR_API__.navigateTo({\n            url: \"/pages/population-list/detail/index?style=\" + style,\n        });\n    }\n});\n"],"names":[],"sourceRoot":""}