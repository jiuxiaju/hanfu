{"version":3,"file":"pages/population-list/index/index.js","mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./pages/population-list/index/index.ts"],"sourcesContent":["var __MOR_API__ = require('@morjs/api').mor;\n\nimport { aPage } from '@ali/mor-core';\n// 获取全局 app 实例\nvar app = getApp();\naPage({\n    data: {\n        infoList: [],\n        stickyProps: {},\n        isFirstLoad: true,\n        filteredData: {},\n        config: {\n            \"knowledge_set\": {\n                \"fields\": [\"chaodai\", \"tags\", \"seasons\", \"detail\"],\n                \"displayValuesOnly\": [\"tags\", \"seasons\", \"detail\"],\n                \"fieldLabels\": { \"chaodai\": \"朝代\" },\n                \"styles\": {\n                    \"chaodai\": {\n                        \"background-color\": \"#a866001a\",\n                        \"color\": \"#A86600\"\n                    },\n                    \"seasons\": {\n                        \"background-color\": \"#e0ffe0\",\n                        \"color\": \"#53A101\"\n                    }\n                }\n            },\n        },\n        mergedData: {},\n        rowColsAvatar: [{ size: '100px', type: 'circle' }],\n        rowColsImage: [{ size: '100px', type: 'rect' }],\n        rowColsContent: [{ width: '80%' }, { width: '100%' }, { width: '80%' }],\n        showLoading: true,\n        displayList: [],\n        batchSize: 10,\n        currentDisplayCount: 0,\n        list: [],\n    },\n    onLoad: function () {\n        this.getpopulationList();\n    },\n    //分享给好友\n    onShareAppMessage: function () {\n        var app = getApp(); // 获取全局应用实例\n        var promise = new Promise(function (resolve) {\n            app.generateShareInfo().then(function (shareInfo) {\n                // 在这里处理生成的分享信息\n                resolve(shareInfo);\n            });\n        });\n        return {\n            title: '九霞裾',\n            path: '/pages/home',\n            promise: promise\n        };\n    },\n    //转发到朋友圈\n    onShareTimeline: function () {\n        return {\n            title: '快来看看'\n        };\n    },\n    onPullDownRefresh: function () {\n        this.getpopulationList();\n    },\n    onStickyScroll: function (event) {\n        console.log(event.detail);\n    },\n    onScrollViewScroll: function (e) {\n        var scrollTop = e.detail.scrollTop; // 用户当前已滚动的距离\n        var scrollHeight = e.detail.scrollHeight; // scroll-view 内容的总高度\n        var scrollViewHeight = 700; // scroll-view 的固定高度\n        var triggerHeight = 200; // 触发加载数据的提前量（距底部 200px）\n        // 检查是否接近底部，并触发数据加载\n        if (scrollTop + scrollViewHeight >= scrollHeight - triggerHeight) {\n            console.log('接近底部，加载更多数据...');\n            // this.loadMoreData();\n            this.onScrollToLower();\n        }\n    },\n    onScrollToLower: function () {\n        // 当滑动到页面底部时触发\n        var _a = this.data, list = _a.list, displayList = _a.displayList, currentDisplayCount = _a.currentDisplayCount, batchSize = _a.batchSize;\n        console.log(currentDisplayCount, 'currentDisplayCount');\n        var nextDisplayCount = currentDisplayCount + batchSize;\n        if (currentDisplayCount < list.length) {\n            // 有更多数据可以加载\n            var moreData = list.slice(currentDisplayCount, nextDisplayCount);\n            this.setData({\n                displayList: displayList.concat(moreData),\n                currentDisplayCount: nextDisplayCount, // 更新已显示的数据数量\n            });\n        }\n    },\n    // 获取科普列表\n    getpopulationList: function (filteredData) {\n        var _this = this;\n        if (filteredData === void 0) { filteredData = {}; }\n        console.log(filteredData, 'filteredData');\n        wx.cloud.callFunction({\n            name: 'onsearchpopulation',\n            data: {\n                filteredData: filteredData // 将 filteredData 传递给云函数作为过滤条件\n            }\n        }).then(function (data) {\n            console.log(data, 'data');\n            var result = data.result;\n            var cardList = result.data;\n            // 判断是否为初次加载，更新 mergedData\n            var newMergedData = _this.data.isFirstLoad ? result.mergedData : _this.data.mergedData;\n            _this.setData({\n                list: cardList,\n                displayList: cardList.slice(0, _this.data.batchSize),\n                showLoading: false,\n                currentDisplayCount: 10,\n                mergedData: newMergedData,\n                config: result.configTemplates\n            });\n            console.log(_this.data.config, 'config');\n        });\n    },\n    handleDynamicChange: function (event) {\n        var _this = this;\n        var filteredData = event.detail;\n        // 打印调试信息\n        console.log(filteredData, 'filteredData-dynamicFilters');\n        this.setData({\n            isFirstLoad: false,\n            filterObject: filteredData\n        }, function () {\n            _this.getpopulationList(filteredData);\n        });\n    },\n    //返回顶部\n    handleToTop: function () {\n        this.setData({ scrollTop: 0 });\n    },\n    getRitch: function (rich) {\n        if (!rich) {\n            return '';\n        }\n        var richClone = rich.replace(/<[^>]*>/g, \"\");\n        return richClone;\n    },\n    handleItemClick: function (event) {\n        var Item = event.detail;\n        __MOR_API__.navigateTo({ url: \"/pages/population-list/detail/index?PopulationById=\" + Item._id });\n    },\n});\n"],"names":[],"sourceRoot":""}